<ion-header [translucent]="true" class="modern-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
      <ion-button class="back-button" (click)="tornaAllaHome()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title class="header-title">
      <div class="logo-section">
        <ion-icon name="book-outline" class="logo-icon"></ion-icon>
        <span>Catalogo Libri</span>
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="modern-content">
  
  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Esplora il Catalogo</h1>
      <p class="hero-subtitle">Scopri i libri disponibili nelle nostre biblioteche</p>
    </div>
    <div class="hero-decoration">
      <div class="decoration-circle circle-1"></div>
      <div class="decoration-circle circle-2"></div>
    </div>
  </div>

  
  <div class="loading-section" *ngIf="isLoading">
    <div class="loading-spinner">
      <ion-spinner name="crescent"></ion-spinner>
    </div>
    <p class="loading-text">Caricamento catalogo...</p>
  </div>
  
  <div class="catalog-container" *ngIf="!isLoading">
    <div class="books-grid">
      <div class="book-card modern-card" *ngFor="let libro of libri">
        <div class="card-header">
          <div class="book-icon">
            <ion-icon name="book-outline"></ion-icon>
          </div>
          <div class="availability-indicator">
            <ion-badge color="primary" *ngIf="ottieniBiblioteceDisponibiliPerLibro(libro.id).length > 0">
              {{ ottieniBiblioteceDisponibiliPerLibro(libro.id).length }} biblioteche
            </ion-badge>
            <ion-badge color="medium" *ngIf="ottieniBiblioteceDisponibiliPerLibro(libro.id).length === 0">
              Non disponibile
            </ion-badge>
          </div>
        </div>
        
        <div class="card-content">
          <h3 class="book-title">{{ libro.title }}</h3>
          
          <div class="book-info">
            <div class="info-item">
              <ion-icon name="person-outline"></ion-icon>
              <div>
                <span class="label">Autore</span>
                <span class="value">{{ libro.author }}</span>
              </div>
            </div>
            
            <div class="info-item">
              <ion-icon name="library-outline"></ion-icon>
              <div>
                <span class="label">Categoria</span>
                <span class="value">{{ libro.category }}</span>
              </div>
            </div>
            
            <div class="info-item">
              <ion-icon name="barcode-outline"></ion-icon>
              <div>
                <span class="label">ISBN</span>
                <span class="value">{{ libro.isbn }}</span>
              </div>
            </div>
          </div>          
          <div class="library-selection" *ngIf="biblioteche.length > 0">
            <div class="selection-header">
              <ion-icon name="location-outline"></ion-icon>
              <span class="selection-label">Seleziona Biblioteca</span>
            </div>
            
            <ion-item class="library-select-item">
              <ion-select 
                [(ngModel)]="bibliotecheSelezionate[libro.id]"
                (ionChange)="cambiaBiblioteca(libro.id, $event.detail.value)"
                placeholder="Scegli biblioteca..."
                interface="popover">
                <ion-select-option 
                  *ngFor="let library of ottieniBiblioteceDisponibiliPerLibro(libro.id)" 
                  [value]="library.id">
                  {{ library.name }} ({{ ottieniNumeroCopieLibroDaBiblioteca(libro.id, library.id) }} copie)
                </ion-select-option>
              </ion-select>
            </ion-item>

            
            <div class="copies-info-card" *ngIf="bibliotecheSelezionate[libro.id]">
              <div class="copies-details">
                <ion-icon name="copy-outline"></ion-icon>
                <span>{{ ottieniNumeroCopieLibroDaBiblioteca(libro.id, bibliotecheSelezionate[libro.id]) }} copie disponibili</span>
              </div>
            </div>
          </div>
                
          <div class="card-actions" *ngIf="biblioteche.length > 0">
            <ion-button 
              expand="block" 
              class="modern-button primary-btn"
              [disabled]="!abilitaPrestito(libro.id) || isProcessingAction[libro.id]"
              (click)="richiediPrestito(libro)">
              <ion-spinner name="crescent" *ngIf="isProcessingAction[libro.id]"></ion-spinner>
              <ion-icon name="download-outline" slot="start" *ngIf="!isProcessingAction[libro.id]"></ion-icon>
              {{ isProcessingAction[libro.id] ? 'Elaborazione...' : 'Prendi in Prestito' }}
            </ion-button>
            
            <ion-button 
              expand="block" 
              class="modern-button secondary-btn"
              fill="outline"
              [disabled]="!abilitaPrenotazione(libro.id) || isProcessingAction[libro.id]"
              (click)="richiediPrenotazione(libro)">
              <ion-spinner name="crescent" *ngIf="isProcessingAction[libro.id]"></ion-spinner>
              <ion-icon name="bookmark-outline" slot="start" *ngIf="!isProcessingAction[libro.id]"></ion-icon>
              {{ isProcessingAction[libro.id] ? 'Elaborazione...' : 'Prenota' }}
            </ion-button>
          </div>          
          <div class="no-libraries-message" *ngIf="biblioteche.length === 0">
            <ion-icon name="alert-circle-outline"></ion-icon>
            <span>Nessuna biblioteca disponibile nel sistema</span>
          </div>
        </div>
      </div>    
    </div>

    
    <div class="empty-state" *ngIf="!isLoading && libri.length === 0">
      <div class="empty-icon">
        <ion-icon name="book-outline"></ion-icon>
      </div>
      <h2>Nessun libro trovato</h2>
      <p>Il catalogo è vuoto o non è stato possibile caricare i libri</p>
    </div>
  </div>

  <ion-toast
    [isOpen]="showToast"
    [message]="toastMessage"
    duration="3000"
    position="top"
    [color]="toastColor"
    (didDismiss)="onToastDismiss()">
  </ion-toast>

</ion-content>

